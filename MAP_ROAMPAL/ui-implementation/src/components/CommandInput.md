# CommandInput.tsx - Map

## Summary

`CommandInput.tsx` is the base UI component for message entry in RoamPal. It provides a rich text area with auto-resize, file attachment support via drag-and-drop or file picker, slash command detection with a visual palette, and voice input hooks. It is the stateless predecessor to `ConnectedCommandInput.tsx`.

---

## Technical Map

### Core Dependencies

- **Icons**: `@heroicons/react` (PaperClipIcon, MicrophoneIcon, PaperAirplaneIcon).

### Component Props (`CommandInputProps`)

- `onSend`: Callback for regular messages (includes text and `File[]` attachments).
- `onCommand`: Callback for slash commands (e.g., `onCommand('clear', [])`).
- `onVoiceStart` / `onVoiceEnd`: Hooks for handling Push-to-Talk voice recording.
- `isProcessing`: Disables the input when the AI is busy.
- `placeholder`: Custom text for the input field.

### Feature logic

#### Auto-resize Textarea (Lines 46-51)

- Uses a `useEffect` on the `message` state to set `height: auto` and then immediately `height: scrollHeight`. This handles shrinking and growing correctly.

#### Command Palette (Lines 19-25, 54-68)

- **Built-in Commands**: `/switch`, `/memory`, `/clear`, `/export`, `/help`.
- **Logic**: Triggers when the first character is `/`. Filters the `COMMANDS` array as the user types.

#### File Attachments (Lines 110-123, 167-185)

- **Selection**: Supports multi-file selection via a hidden native input or drag-and-drop.
- **Visuals**: Displays small "chips" for each attached file with a remove (Ã—) button.
- **State**: `attachments` state stores the raw `File` objects.

#### Keyboard Shortcuts (Lines 86-108)

- **Navigation**: Arrow keys to select from the command palette.
- **Enter**: Sends the message if Shift is not held; inserts a newline otherwise.

### UI Structure

- **Command Palette (Lines 128-150)**: Absolute positioned list above the input triggered by `/`.
- **Main Container (Lines 153-165)**: A `zinc-950` box that highlights blue when a file is dragged over it (`isDragging` state).
- **Textarea (Lines 189-198)**: Unstyled, auto-expanding area.
- **Actions Row (Lines 201-240)**:
  - Hidden File Input.
  - Attach Button.
  - Voice Button (triggers `onVoiceStart` on `mousedown`).
  - Send Button.
- **Status Line (Lines 244-249)**: Zinc-colored help text for shortcuts.

---

## Connection & Dependencies

- **ConnectedCommandInput.tsx**: Wraps this component to provide direct integration with `useChatStore`.
- **TerminalMessageThread.tsx**: Receives the output generated by the callbacks of this input.
- **MENTIONS**: Pre-defined list of system personas (`@roampal`, `@dev`, etc.), though logic for handling them is handled in parent components.
